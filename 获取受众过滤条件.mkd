接口说明



## 获取受众过滤条件

**说明：** 获取App实验过滤条件，用于受众规则圈选，当前仅支持编程实验-服务端实验。

说明

私有化4.9.0版本开始新增支持此接口。

**请求路径：**`/openapi/v3/apps/{app_id}/para-filters`
**请求方法：GET**
**请求参数**

| 参数名称        | 参数类型 | 是否必填 | 描述                                                 |
| --------------- | -------- | -------- | ---------------------------------------------------- |
| experiment_mode | string   | 是       | 实验类型，当前仅支持编程实验，需配置为“coding”。     |
| side_type       | string   | 是       | 实验端类型，当前仅支持服务端实验，需配置为“server”。 |

**返回值**

| 参数名称 | 类型   | 说明                                                         |
| -------- | ------ | ------------------------------------------------------------ |
| code     | int    | 接口返回状态，200为成功                                      |
| message  | string | 接口返回信息，成功时默认为success                            |
| data     | object | 接口返回的服务端过滤条件。结构如下：`{ "list":[{},{},...] } `注意私有化-CDP联合部署环境下，服务端编程实验会返回用户分群列表。 |

**data结构说明**

| 参数名称      | 类型   | 说明                                       |
| ------------- | ------ | ------------------------------------------ |
| id            | int    | 过滤参数ID                                 |
| name          | string | 过滤参数名称                               |
| description   | string | 描述信息                                   |
| key           | string | 过滤参数Key                                |
| type          | string | 过滤参数Value类型                          |
| owner         | object | owner信息列表                              |
| modify_time   | int    | 参数更新时间戳(秒)                         |
| attribute     | string | 过滤参数属性                               |
| options       | object | 过滤参数可取值列表，直接参考下方样例       |
| op            | object | 过滤参数可以进行的操作符, 直接参考下方样例 |
| property_type | string | 过滤参数参数类型                           |

说明

返回的数据中，主要需要关注下面几个字段，用于拼接实验的受众过滤规则：

- key： 参数Key， 其中**cohort**的表示当前系统中圈选的分群
- type：参数value类型，进而决定操作符
- op： 可进行的操作符
- property_type：参数类型，其中cdp_cohort标识是cdp的分群

**示例**

```Bash
{
    "code": 200,
    "data": {
        "list":[
                {
                    "id": 12463,
                    "name": "姓名",
                    "key": "name",
                    "type": "string",
                    "owner": [
                        {
                            "id": 238434,
                            "name": "zhangsan",
                            "avatar": "https://sf3-ttcdn-tos.pstatp.com/obj/byterangers-avatar/NPTDy24097558461*****.png"
                        }
                    ],
                    "modify_time": 1695108262,
                    "attribute": "profile",
                    "options": [
                        {
                            "label": "",
                            "value": "syz"
                        },
                        {
                            "label": "",
                            "value": "cy"
                        }
                    ],
                    
                },
                {
                    "id": 0,
                    "name": "用户分群",
                    "description": "",
                    "key": "cohort",
                    "type": "int",
                    "owner": [],
                    "modify_time": 0,
                    "attribute": "common_param",
                    "options": [
                        {
                            "label": "昨天做了任意事件_20231206174256586",
                            "value": 1022367
                        },
                        ...
                },
                ...
            ]
    }
    "message": "success"
}
```



## 创建实验

注意

开放接口所创建的实验，仅管理员可编辑

**接口描述：** 创建一个编程实验或MAB实验。
**请求路径：**`/openapi/v3/apps/{app_id}/experiments`
**请求方法：POST**
**请求参数**

| 参数名称                | 参数类型 | 是否必填 | 描述                                                         | 备注                                                         |
| ----------------------- | -------- | -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| name                    | string   | 是       | 实验名称                                                     | 不能与当前APP下已有实验重名，长度限制200字符                 |
| description             | string   | 否       | 实验描述                                                     | 长度限制1000字符                                             |
| tags                    | string   | 否       | 实验标签                                                     | ["123", "456"]                                               |
| owners                  | object   | 否       | 创建人                                                       | 实验owner列表，owner的object数据结构包括id和name两个参数：id：int类型，必填，表示用户ID。name：string类型，必填，表示用户名。您可以使用**用户信息查询**接口获取实验owners的数值。 |
| endpoint_type           | int      | 是       | 实验类型                                                     | 0-客户端实验，1-服务端实验                                   |
| duration                | int      | 是       | 实验时长                                                     | 单位天，范围：[1, 365]                                       |
| major_metric            | int      | 是       | 核心指标ID                                                   | 必须在metrics中                                              |
| metrics                 | int[]    | 是       | 关注的指标ID列表                                             | 必须包含major_metric                                         |
| versions                | object[] | 是       | 实验版本配置                                                 | 数组长度要大于等于2，详见version结构说明                     |
| layer_info              | object   | 是       | 实验层配置                                                   | 详见layer_info说明                                           |
| mab_info                | object   | 否       | MAB实验配置信息                                              | 如果是创建MAB实验，该字段必传。详细介绍请参见下文的mab_info结构说明。 |
| user_group_filter_rules | object[] | 否       | 客群实验受众规则列表。详情请参见下文的**user_group_filter_rules结构说明**章节。 | 4.9.0版本开始，与CDP联合部署时，新增支持创建客群实验，使用客群进行受众规则配置时需配置此参数。 |
| manage_sub_type         | string   | 否       | 特性实验子类型，仅可配置为：user_group。                     | null                                                         |

注意

- 配置mab组和对应的非mab组的配置要相同，也就是mab和非mab组的配置是一对一对的。具体参见下文的例子，例如智能调优组"对照组"和评估组"对照组-Besfw"是一一对应的。
- 私有化480版本mab核心指标只支持单事件转化率类型的指标，uv_per_dau（算子为：转化率）。

**version结构说明**

| 参数名称    | 参数类型 | 是否必填 | 描述                            | 备注                                                         |
| ----------- | -------- | -------- | ------------------------------- | ------------------------------------------------------------ |
| type        | int      | 是       | 对照版本/实验版本               | 0-对照版本，1-实验版本 versions数组中只能有一个对照版本      |
| name        | string   | 是       | 版本名称                        | 长度50字符                                                   |
| description | string   | 否       | 版本描述                        | 长度1000字符                                                 |
| weight      | float    | 否       | 实验版本的流量分配              | 范围[0.001, 1] 0.1% ~ 100% versions数组中不传，则默认均匀分配 如果传，则会校验所有weight的和是否为1 |
| config      | object   | 是       | 版本配置                        | version数组中所有config的key需要保持一致 { "key1": "value1", "key2": "value2" } |
| users       | string[] | 否       | 白名单用户                      | 不同版本的白名单用户不能有交集                               |
| is_mab      | int      | 否       | 是否为mab智能流量组，取值：0或1 |                                                              |

**layer_info结构说明**

| 参数名称         | 参数类型 | 是否必填 | 描述         | 备注                                                         |
| ---------------- | -------- | -------- | ------------ | ------------------------------------------------------------ |
| layer_id         | int      | 否       | 互斥组ID     | 使用的实验层，使用默认层则传-1或不传 如果指定了layer_id，则会校验实验层上可用流量是否满足实验配置 |
| version_resource | float    | 是       | 实验流量占比 | 范围[0.001, 1]，最小精度千分之一                             |

**mab_info结构说明**

| **参数名称**    | **参数类型** | **是否必填** | **描述**           | **备注**                                                     |
| --------------- | ------------ | ------------ | ------------------ | ------------------------------------------------------------ |
| interval_time   | int          | 是           | 调优间隔，单位：秒 | 单位秒，最小间隔30分钟，并且按照30分钟增加，例如1800, 3600, 5400。 |
| non_mab_traffic | int          | 是           | 评估流量占比       | 百分比，例如6就是6%，每个实验组最低需要3%的评估流量，例如三个实验组最低需要9%的评估流量。 |

**user_group_filter_rules结构说明**

| **参数名称** | **参数类型** | **是否必填** | **描述**                                                     |
| ------------ | ------------ | ------------ | ------------------------------------------------------------ |
| name         | string       | 是           | 客群名称                                                     |
| type         | int          | 是           | 对照客群/实验客群0：对照客群1：实验客群user_group_filter_rules数组中只能有一个对照客群 |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | int    | 新创建实验ID                      |

**示例**
编程实验，两个评估组，两个智能调优组，一共4个组，调优间隔30分钟，评估流量6%。

```JSON
{
    "name": "test-mab",
    "duration": 14,
    "versions": [
        {
            "name": "对照组",
            "label": "对照组",
            "weight": 0.47,
            "is_mab": 1,
            "type": 0,
            "config": {
                "HcCVhO": "_Lf5XM"
            },
            "users": []
        },
        {
            "name": "实验组1",
            "label": "实验组1",
            "weight": 0.47,
            "is_mab": 1,
            "type": 1,
            "config": {
                "HcCVhO": "TAqqd4"
            },
            "users": []
        },
        {
            "name": "对照组-Besfw",
            "label": "对照组",
            "weight": 0.03,
            "is_mab": 0,
            "type": 1,
            "config": {
                "HcCVhO": "ij45wC"
            },
            "users": []
        },
        {
            "name": "实验组1-fL17k",
            "label": "实验组1",
            "weight": 0.03,
            "is_mab": 0,
            "type": 1,
            "config": {
                "HcCVhO": "WRDoSW"
            },
            "users": []
        }
    ],
    "major_metric": 100942,
    "metrics": [
        100940,
        100941,
        100942,
        100943,
        100944,
        100945,
        100946
    ],
    "mode": 1,
    "mab_info": {
        "interval_time": 1800,
        "non_mab_traffic": 6
    },
    "endpoint_type": 0,
    "layer_info": {
        "layer_id": -1,
        "version_resource": 1
    }
    {
    "user_group_filter_rules": [
        {
            "name": "\u5ba2\u7fa4A",
            "type": 0,
            "filter_rule": [
                {
                    "logic": "||",
                    "conditions": [
                        {
                            "logic": "&&",
                            "condition": {
                                "key": "automation_copy_aaaessrssb_Int",
                                "type": "int",
                                "op": "==",
                                "value": [
                                    1
                                ],
                                "property_type": "common_param"
                            }
                        }
                    ]
                }
            ]
        },
        {
            "name": "\u5ba2\u7fa4B",
            "type": 1,
            "filter_rule": [
                {
                    "logic": "||",
                    "conditions": [
                        {
                            "logic": "&&",
                            "condition": {
                                "key": "cohort",
                                "type": "int",
                                "op": "==",
                                "value": [
                                    1000004
                                ],
                                "property_type": "cdp_cohort"
                            }
                        }
                    ]
                }
            ]
        }
    ],
    "manage_sub_type": "user_group",      // 实验的子类型字段，这里是客群传递user_group，若用户编辑rollback后传递空串或者不传都可以，后端会判断对应更新实验表
}
}
```



## 获取实验详情

**说明：** 根据实验ID获取实验详情
**请求路径：**`/openapi/v3/apps/{app_id}/experiments/{experiment_id}`
**请求方法：GET**
**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | object | 接口返回的实验信息                |

**data信息**

| 参数名称   | 类型   | 说明     |
| ---------- | ------ | -------- |
| experiment | object | 实验信息 |

**experiment结构说明**

| 参数名称                | 类型       | 说明                                                |
| ----------------------- | ---------- | --------------------------------------------------- |
| id                      | int        | 实验的experiment_id                                 |
| name                    | string     | 实验名称                                            |
| tags                    | string     | 标签列表                                            |
| owners                  | object     | owner信息列表                                       |
| launch_start_time       | long       | 实验开始时间，Unix时间戳                            |
| end_time                | long       | 实验结束时间，Unix时间戳                            |
| create_time             | long       | 实验创建时间，Unix时间戳                            |
| modify_time             | long       | 实验修改时间，Unix时间戳                            |
| test_start_time         | long       | 实验调试开始时间，Unix时间戳                        |
| duration                | long       | 实验运行时间，单位秒                                |
| confidence_level        | int        | 置信度水平，95代表置信度水平为95%                   |
| version_resource        | float      | 实验所占流量，范围[0.001, 1]，1为100%               |
| layer_id                | int        | 实验层id                                            |
| freeze_status           | int        | 实验冻结状态 1-冻结，0-没冻结                       |
| freeze_time             | long       | 实验冻结时间，Unix时间戳（只有冻结状态为1时才有效） |
| version_freeze_status   | int        | 是否进组不出组 1-是 0-否                            |
| pause_status            | int        | 实验是否暂停 1-暂停 0-不暂停                        |
| endpoint_type           | int        | 0-客户端实验，1-服务端实验                          |
| versions                | object[]   | 实验版本信息                                        |
| metrics                 | object[]   | 实验关注指标信息                                    |
| status                  | int/enum   | 实验状态， 0:已结束 1:运行中 2: 待调度 3:调试中     |
| filters                 | string     | 实验受众目标，json字符串                            |
| description             | string     | 实验描述                                            |
| user_group_filter_rules | List[Dict] | 客群实验受众规则列表                                |
| manage_sub_type         | string     | 特性实验子类型                                      |

| 参数名称              | 类型     | 说明                                                         |
| --------------------- | -------- | ------------------------------------------------------------ |
| id                    | int      | 实验的experiment_id                                          |
| name                  | string   | 实验名称                                                     |
| tags                  | string   | 标签列表                                                     |
| owners                | object   | owner信息列表，包含以下字段：id：int，账号IDname：string，用户名account：string，用户账号名称（私有化4.9.0版本开始支持返回account参数） |
| launch_start_time     | long     | 实验开始时间，Unix时间戳                                     |
| end_time              | long     | 实验结束时间，Unix时间戳                                     |
| create_time           | long     | 实验创建时间，Unix时间戳                                     |
| modify_time           | long     | 实验修改时间，Unix时间戳                                     |
| test_start_time       | long     | 实验调试开始时间，Unix时间戳                                 |
| duration              | long     | 实验运行时间，单位秒                                         |
| confidence_level      | int      | 置信度水平，95代表置信度水平为95%                            |
| version_resource      | float    | 实验所占流量，范围[0.001, 1]，1为100%                        |
| layer_id              | int      | 实验层id                                                     |
| freeze_status         | int      | 实验冻结状态 1-冻结，0-没冻结                                |
| freeze_time           | long     | 实验冻结时间，Unix时间戳（只有冻结状态为1时才有效）          |
| version_freeze_status | int      | 是否进组不出组 1-是 0-否                                     |
| pause_status          | int      | 实验是否暂停 1-暂停 0-不暂停                                 |
| endpoint_type         | int      | 0-客户端实验，1-服务端实验                                   |
| versions              | object[] | 实验版本信息                                                 |
| metrics               | object[] | 实验关注指标信息                                             |
| status                | int/enum | 实验状态， 0:已结束 1:运行中 2: 待调度 3:调试中              |
| filters               | string   | 实验受众目标，json字符串                                     |
|                       |          |                                                              |

**metric结构说明**

| 参数名称       | 类型    | 说明                        |
| -------------- | ------- | --------------------------- |
| id             | int     | 指标id                      |
| name           | string  | 指标名称                    |
| description    | string  | 指标描述                    |
| is_primary     | int     | 是否核心指标：0-否 1-是     |
| calculate_type | string  | 指标计算类型                |
| dsl            | object  | 指标dsl                     |
| status         | int     | 指标状态 0: 已下线 1:没下线 |
| is_composed    | boolean | 是否组合指标：true/false    |
| data_type      | string  | 指标展现数值格式            |

**version结构说明**

| 参数名称    | 类型     | 说明                                            |
| ----------- | -------- | ----------------------------------------------- |
| id          | int      | 版本id                                          |
| type        | int      | 版本类型：0-对照版本，1-实验版本                |
| name        | string   | 版本名称                                        |
| description | string   | 版本描述                                        |
| config      | object   | 版本配置 { "key1": "value1", "key2": "value2" } |
| weight      | int      | 版本权重，和为1000，1代表0.1% 为0则为均匀分配   |
| user_list   | string[] | 白名单列表                                      |



## 获取实验列表

**说明：** 分页获取APP下的实验列表
**注意：如果搜索关键字keyword包含中文，则需要先进行url转义，再进行调用**
**请求路径：**`/openapi/v3/apps/<app_id>/experiments`
**请求方法：GET**
**URL查询参数**

| 参数       | 类型   | 说明                                                         |
| ---------- | ------ | ------------------------------------------------------------ |
| status     | int    | 实验状态，0-已结束，1-运行中，3-测试中；不传则默认所有状态   |
| page       | int    | 分页参数，1表示第一页，不传默认为1                           |
| page_size  | int    | 每页数量，不传默认99                                         |
| keyword    | string | 搜索关键字，当前支持按照实验name和description模糊搜索        |
| sort_by    | string | 排序规则。当前仅支持 end_time结束时间、launch_start_time实验启动时间、test_start_time测试开始时间； 不传默认实验创建时间 |
| sort_order | string | 排序顺序。desc/asc。不传默认desc降序                         |

**返回值**

| 参数名称 | 类型   | 说明                                                         |
| -------- | ------ | ------------------------------------------------------------ |
| code     | int    | 接口返回状态，200为成功                                      |
| message  | string | 接口返回信息，成功时默认为success                            |
| data     | object | { "experiments": [], "page": { "current_page": 1, // 当前页 "total_pages": 0, // 总页数 "total_items": 0 // 总条目数 } } |

**experiments结构说明**

| 参数名称              | 类型     | 说明                                                |
| --------------------- | -------- | --------------------------------------------------- |
| id                    | int      | 实验ID                                              |
| name                  | string   | 实验名称                                            |
| end_time              | long     | 实验结束时间，Unix时间戳                            |
| test_start_time       | long     | 实验调试开始时间，Unix时间戳                        |
| launch_start_time     | long     | 实验开始时间，Unix时间戳                            |
| duration              | long     | 实验运行时间，单位秒                                |
| version_resource      | float    | 实验所占流量，范围[0.001, 1]，1为100%               |
| layer_id              | int      | 实验层id                                            |
| freeze_status         | int      | 实验冻结状态 1-冻结，0-没冻结                       |
| freeze_time           | long     | 实验冻结时间，Unix时间戳（只有冻结状态为1时才有效） |
| version_freeze_status | int      | 是否进组不出组 1-是 0-否                            |
| pause_status          | int      | 实验是否暂停 1-暂停 0-不暂停                        |
| endpoint_type         | int      | 0-客户端实验，1-服务端实验                          |
| description           | string   | 实验描述                                            |
| status                | int/enum | 实验状态， 0:已结束 1:运行中 2: 待调度 3:调试中     |
| owner                 | 字符串   | 实验创建人                                          |
| versions              | object[] | 实验版本信息                                        |



## **修改实验信息**

**说明：** 修改实验的配置信息。**通过Method来区分是全量修改还是部分修改**。

- 全量修改：Method=PUT。请求参数中的所有必填参数必须包含。
- 部分修改：Method=PATCH。可以任意传递支持的配置参数，请求体中有的参数，才会进行校验与修改，请求体中没有的参数，则会保持现状。

**注意：由于使用的网络库本身不支持不支持PATCH方法，因此Java SDK暂不支持PATCH方法**
**请求路径：**`/openapi/v3/apps/{app_id}/experiments/<experiment_id>`
请求方法：PUT/PATCH
**请求参数**

| 参数名称                | 参数类型 | 是否必须 | 描述                                                         | 备注                                       |
| ----------------------- | -------- | -------- | ------------------------------------------------------------ | ------------------------------------------ |
| name                    | string   | 是       | 实验名称                                                     | 不能与已有实验重名，长度50字符             |
| description             | string   | 否       | 实验描述                                                     | 长度1000字符                               |
| tags                    | string   | 否       | 实验标签                                                     | ["123", "456"]                             |
| owners                  | object   | 否       | 创建人                                                       | 实验owner列表                              |
| duration                | int      | 是       | 实验时长                                                     | 单位天，[1, 365]，整数                     |
| major_metric            | int      | 是       | 核心指标 ID                                                  | 运行中不可修改 测试中可以修改              |
| metrics                 | int[]    | 是       | 指标ID列表                                                   |                                            |
| versions                | object[] | 是       | 实验版本                                                     | version数量不可变动，只可以修改version内容 |
| layer_info              | object   | 否       | 互斥组                                                       |                                            |
| user_group_filter_rules | object[] | 否       | 客群实验受众规则列表。详情请参见下文的**user_group_filter_rules结构说明**章节。 |                                            |
| manage_sub_type         | string   | 否       | 特性实验子类型，仅可配置为：user_group。                     |                                            |

**version结构**

| 参数名称    | 参数类型 | 是否必填 | 描述                                | 备注                                                         |
| ----------- | -------- | -------- | ----------------------------------- | ------------------------------------------------------------ |
| id          | int      | 是       | 版本ID                              | 修改version信息必填                                          |
| name        | string   | 是       | 版本名称                            | 长度50字符                                                   |
| description | string   | 否       | 版本描述                            | 长度1000字符                                                 |
| weight      | float    | 否       | 流量分配                            | 范围[0.001, 1] 0.1% ~ 100% versions数组中不传，则默认均匀分配 如果传，则会校验所有weight的和是否为1 |
| config      | object   | 是       | 版本参数不同版本的 key 需要保持一致 | version数组中所有config的key需要保持一致 { "key1": "value1", "key2": "value2" } |
| users       | string[] | 否       | 白名单用户                          |                                                              |

**layer_info结构**

| 参数名称         | 参数类型 | 是否必填 | 描述           | 备注                             |
| ---------------- | -------- | -------- | -------------- | -------------------------------- |
| layer_id         | int      | 否       | 互斥组 ID      |                                  |
| version_resource | float    | 是       | 占用流量百分比 | 范围[0.001, 1]，最小精度千分之一 |

**user_group_filter_rules结构**

| **参数名称** | **参数类型** | **是否必填** | **描述**                                                     |
| ------------ | ------------ | ------------ | ------------------------------------------------------------ |
| name         | string       | 是           | 客群名称                                                     |
| type         | int          | 是           | 对照客群/实验客群0：对照客群1：实验客群user_group_filter_rules数组中只能有一个对照客群 |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | object | 实验ID                            |



## 开始实验

**说明：** 开始一个测试中的实验。使其状态变为运行中。
**请求路径：** `/openapi/v3/apps/<app_id>/experiments/<experiment_id>/launch`
**请求方法：** PUT
**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | object | 实验ID                            |



## 暂停实验

**说明：** 暂停指定实验，4.9.0版本开始支持此接口
**请求路径** : `/openapi/v3/apps/<app_id>/experiments/<experiment_id>/pause`
**请求方法:** POST
**请求参数**

| 参数名称 | 类型 | 说明                                                         |
| -------- | ---- | ------------------------------------------------------------ |
| duration | int  | 暂停某个实验时，实验流量是平滑生效的，通过此参数设置平滑生效的时间是多少分钟 |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |



## 恢复实验

**说明：** 恢复指定实验，4.9.0版本开始支持此接口
**请求路径** : `/openapi/v3/apps/<app_id>/experiments/<experiment_id>/restore`
**请求方法:** POST
**请求参数**

| 参数名称 | 类型 | 说明                                                         |
| -------- | ---- | ------------------------------------------------------------ |
| duration | int  | 恢复某个实验时，实验流量是平滑生效的，通过此参数设置平滑生效的时间是多少分钟 |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |



## 结束实验

**说明：** 结束指定实验
**请求路径** : `/openapi/v3/apps/<app_id>/experiments/<experiment_id>/stop`
**请求方法:** PUT
**返回值**

| 参数名称 | 类型   | 说明                                                         |
| -------- | ------ | ------------------------------------------------------------ |
| code     | int    | 接口返回状态，200为成功，非200的错误码说明如下：400：业务逻辑错误500：服务异常 |
| message  | string | 接口返回信息，成功时默认为success                            |
| data     | object | 实验ID                                                       |



## 关闭实验组

**说明**： 关闭某个实验组
**请求路径** : `/openapi/v3/apps/<app_id>/experiments/:flight_id/versions/:version_id/close`
**请求方法:** POST
**请求参数**

| 参数       | 类型    | 说明                     |
| ---------- | ------- | ------------------------ |
| app_id     | integer | 路径参数，实验所属app_id |
| flight_id  | integer | 路径参数，实验ID         |
| version_id | integer | 路径参数，实验组ID       |

**返回值**

| 参数名称 | 类型   | 说明                                                         |
| -------- | ------ | ------------------------------------------------------------ |
| code     | int    | 接口返回状态，200为成功，非200的错误码说明如下：400：业务逻辑错误500：服务异常 |
| message  | string | 接口返回信息，成功时默认为success                            |



## 创建指标

**说明**： 创建一个A/B测试指标
**请求路径：** `/openapi/v3/apps/<app_id>/metrics`
**请求方法**：POST
**请求参数**

| 参数名称    | 类型    | 是否必须 | 描述           | 备注                                                         |
| ----------- | ------- | -------- | -------------- | ------------------------------------------------------------ |
| name        | string  | 是       | 指标名称       | 长度限制 50，不可与相同APP下其他指标重复                     |
| description | string  | 否       | 指标描述       | 长度限制 1000                                                |
| dsl         | object  | 是       | 指标DSL        | dsl详情可咨询对接人员                                        |
| composed    | boolean | 是       | 是否是组合指标 | true/false                                                   |
| data_type   | string  | 否       | 数据展示类型   | 枚举值 number_0, number_1, number_2, number_3, number_4, number_5, percent_0, percent_1, percent_2, percent_3, percent_4, percent_5 默认为percent_4，即百分数四位小数 |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | int    | 指标ID                            |



## **基于指标模板创建指标**

**说明：** 基于现存的A/B测试指标，通过修改其中的属性过滤信息，创建新的A/B测试指标。只会替换模板指标中同名的属性值，模板指标中不存在的属性会忽略。如果传入多个 metrics，要修改的属性信息会分别应用于每个 metric。
可以简单理解为把每个模板指标都复制一份，然后修改其已存在的 property 信息。
**请求路径：** /openapi/v3/apps/<app_id>/metrics/create-from-templates
**请求方法：** POST
**请求参数**

| 参数名称   | 类型           | 是否必须 | 描述               | 备注                |
| ---------- | -------------- | -------- | ------------------ | ------------------- |
| metrics    | list[metric]   | 是       | 指标信息列表       | metric 见下表说明   |
| properties | list[property] | 是       | 需要修改的属性信息 | property 见下表说明 |

metric字段说明

| 参数名称    | 类型   | 是否必须 | 描述                             | 备注                                     |
| ----------- | ------ | -------- | -------------------------------- | ---------------------------------------- |
| metric_id   | int    | 是       | 模板指标id                       | 已存在的指标id                           |
| name        | string | 是       | 根据模板指标，新建指标的名称     | 长度限制 50，不可与相同APP下其他指标重复 |
| description | string | 否       | 根据模板指标，新建指标的指标信息 | 长度限制 1000                            |

property字段说明

| 参数名称        | 类型                 | 是否必须 | 描述     | 备注                                                         |
| --------------- | -------------------- | -------- | -------- | ------------------------------------------------------------ |
| property_name   | string               | 是       | 属性名称 | 模板中不存在的属性名会直接忽略，不报错                       |
| property_values | string/int/float数组 | 是       | 属性值   | 长度限制255，如果为空，则是[]；属性值类型需要与模板指标的属性类型保持一致。具体字段说明可参考 [V3 DSL 字段详细说明](https://bytedance.feishu.cn/wiki/wikcnoc1Nr7G3hcECZeQq9zA2Pf#) |

**返回值**

| 参数名称 | 类型         | 说明                              |
| -------- | ------------ | --------------------------------- |
| code     | int          | 接口返回状态，200为成功           |
| message  | string       | 接口返回信息，成功时默认为success |
| data     | list[object] | 新创建的指标信息                  |

object字段说明

| 参数名称 | 类型   | 说明             |
| -------- | ------ | ---------------- |
| id       | int    | 新创建的指标ID   |
| name     | string | 新创建的指标名称 |

```sql
curl --location --request POST '{host}/datatester/openapi/v3/apps/253047/metrics/create-from-template' \
--header 'Content-Type: application/json' \
--data-raw '{
    "metrics": [
        {
            "metric_id": 33487,
            "name": "测试一下事件指标5",
            "description": "这是一个description"
        },
        {
            "metric_id": 33488,
            "name": "测试一下事件指标6",
            "description": "这是一个description"
        }
    ],
    "properties": [
        {
            "property_name": "app_channel",
            "property_values": [
                "channel3",
                "channel4"
            ]
        },
        {
            "property_name": "account_id",
            "property_values": [
                "1234556",
                "7654321"
            ]
        }
    ]
}'
```



## 删除指标

**说明：** 删除指定的指标。**如果指标有已经关联的实验，则无法删除**
**请求路径:** `/openapi/v3/apps/<app_id>/metrics/<metric_id>`
**请求方法: DELETE**
**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | int    | 指标ID                            |



## 获取指标详情

**说明：** 获取指定指标的详情数据
**请求路径：** `/openapi/v3/apps/<app_id>/metrics/<metric_id>`
**请求方法: GET**
**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | object | 指标信息 {"metric_info": }        |

**指标信息说明**

| 参数名称         | 类型    | 说明                   |
| ---------------- | ------- | ---------------------- |
| id               | int     | 指标ID                 |
| name             | string  | 指标名                 |
| description      | string  | 描述                   |
| dsl              | object  | 指标dsl                |
| composed         | boolean | 是否是组合指标         |
| status           | int     | 状态 0-下线 1-上线     |
| is_support_major | boolean | 是否支持设置为核心指标 |



## 获取指标列表

**说明：** 分页获取APP下的指标列表
**请求路径：**`/openapi/v3/apps/<app_id>/metrics`
**请求方法：GET**
**URL查询参数**

| 参数      | 类型   | 说明                                                  |
| --------- | ------ | ----------------------------------------------------- |
| status    | int    | 指标状态，0-下线 1-上线，不传则默认所有状态           |
| page      | int    | 分页参数，1表示第一页，不传默认为1                    |
| page_size | int    | 每页数量，不传默认99                                  |
| keyword   | string | 搜索关键字，当前支持按照指标name和description模糊搜索 |

**返回值**

| 参数名称 | 类型   | 说明                                                         |
| -------- | ------ | ------------------------------------------------------------ |
| code     | int    | 接口返回状态，200为成功                                      |
| message  | string | 接口返回信息，成功时默认为success                            |
| data     | object | { "metrics": [], "page": { "current_page": 1, // 当前页 "total_pages": 0, // 总页数 "total_items": 0 // 总条目数 } } |

**指标信息说明**

| 参数名称         | 类型    | 说明                   |
| ---------------- | ------- | ---------------------- |
| id               | int     | 指标ID                 |
| name             | string  | 指标名                 |
| description      | string  | 描述                   |
| dsl              | object  | 指标dsl                |
| composed         | boolean | 是否是组合指标         |
| status           | int     | 状态 0-下线 1-上线     |
| is_support_major | boolean | 是否支持设置为核心指标 |



## 获取指标组详情

**说明：** 获取指定指标组的详情数据
**请求路径：** `/openapi/v3/apps/<app_id>/metric-groups/<metric_group_id>`
**请求方法: GET**
**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | object | 指标组信息 {"metric_info": }      |

**指标组信息说明**

- body.data

  | 字段名 | 描述       |
  | ------ | ---------- |
  | id     | 指标组id   |
  | name   | 指标组名称 |

- body.metrics[0]

  | 字段名                          | 描述                                                         |
  | ------------------------------- | ------------------------------------------------------------ |
  | id                              | 指标id                                                       |
  | name                            | 指标名称                                                     |
  | type                            | 指标类型portable：数仓指标tea：uba指标，除数仓指标外的其他指标均为tea类型的uba指标 |
  | composed                        | 是否组合指标true：组合指标false：单一指标                    |
  | is_experimental_property_filter | 是否支持灵活属性1：支持，返回支持的灵活属性详情，格式可参见下文的：body.metrics[0].experimental_property_filter_tpl0：不支持 |

- body.metrics[0].experimental_property_filter_tpl

  ```JSON
  {
    "A": {
      "event_id": 89,
      "event_name": "any_event",
      "properties": [
        {
          "property_type": "common_param",
          "property_value_type": "string",
          "property_name": "user_agent"
        }
      ]
    },
    "B": {
      "event_id": 91,
      "event_name": "app_launch",
      "properties": [
        {
          "property_type": "user_profile",
          "property_value_type": "datetime",
          "property_name": "first_event_time"
        }
      ]
    },
    "all": {
      "properties": [
        {
          "property_type": "user_profile",
          "property_value_type": "string",
          "property_name": "gender"
        }
      ]
    }
  }
  ```

  灵活属性详情的返回结果字段详情与DataFinder的DSL结构说明类似，主要字段如下，更多详情请参见[DSL结构说明](https://www.volcengine.com/docs/6285/196703#_2-dsl-结构说明)。

  | 字段名              | 描述                                                     |
  | ------------------- | -------------------------------------------------------- |
  | A、B                | 对应DSL中的show_label。                                  |
  | all                 | 对所有事件生效的属性                                     |
  | properties          | 指标属性描述                                             |
  | property_name       | 属性名称                                                 |
  | property_type       | 属性类型common_param：公共事件属性user_profile：用户属性 |
  | property_value_type | 属性值类型 int/string/long/float                         |

**返回示例**

- 查询数仓指标组详情

  ```JSON
  {
    "code": 0,
    "data": {
      "id": 60,
      "name": "portable（单一+组合指标）45712",
      "status": 1,
      "description": "",
      "type": "portable",
      "uba_report_type": 1,
      "uba_app_id": 0,
      "owners": [
        {
          "id": 1,
          "name": "admin",
          "avatar": null,
          "is_superuser": null
        }
      ],
      "app_ids": [
        10000001
      ],
      "import_app_ids": [],
      "tags": [],
      "merge_types": {
        "total_start_time": 0,
        "support_accumulate": 0,
        "support_total": 0,
        "support_avg": 1
      },
      "metric_scenes": [],
      "sla": "",
      "metrics": [
        {
          "id": 10397,
          "name": "SUM/UV-灵活",
          "description": "",
          "status": 1,
          "dsl": {
            "version": 3,
            "content": {
              "queries": [
                [
                  {
                    "dataset_id": 9,
                    "event_indicator": "measure",
                    "filters": [],
                    "measure_info": {
                      "field_name": "amount",
                      "measure_type": "sum",
                      "property_type": "profile",
                      "value_type": "int"
                    },
                    "nickname": "",
                    "show_label": "A"
                  }
                ],
                [
                  {
                    "dataset_id": 9,
                    "event_indicator": "event_users",
                    "filters": [],
                    "nickname": "",
                    "show_label": "B"
                  }
                ],
                [
                  {
                    "formula": "A/B",
                    "show_label": "metric_relation",
                    "show_name": "指标关系"
                  }
                ]
              ],
              "profile_filters": [],
              "show_option": null,
              "option": null
            }
          },
          "composed": true,
          "data_type": "number_4",
          "type": "portable",
          "is_required": 0,
          "permission_type": "public",
          "calculate_type": "events_per_user",
          "create_time": 1724056602,
          "modify_time": 1724056637,
          "support_confidence": true,
          "is_support_major": true,
          "experiment_num": 2,
          "key": "",
          "file": "",
          "is_hourly": 0,
          "support_bayes": 0,
          "need_weighted": 0,
          "weighted_metric_id": null,
          "visible": true,
          "major_metric_num": 0,
          "has_running_experiments": true,
          "is_defense_metric": 0,
          "defenses": [],
          "use_pre_sql": 0,
          "pre_alert": 0,
          "merge_pre_sql": "",
          "avg_pre_sql": "",
          "first_entry_avg_pre_sql": "",
          "extra_info": "{\"is_experimental_property_filter\":1,\"experimental_property_filter_tpl\":{\"A\":{\"properties\":[{\"property_value_type\":\"int\",\"property_name\":\"amount\"}]},\"B\":{\"properties\":[{\"property_value_type\":\"string\",\"property_name\":\"order_no\"}]},\"all\":{\"properties\":[{\"property_value_type\":\"string\",\"property_name\":\"product_type\"}]}}}",
          "is_experimental_property_filter": 1,
          "experimental_property_filter_tpl": {
            "A": {
              "properties": [
                {
                  "property_value_type": "int",
                  "property_name": "amount"
                }
              ]
            },
            "B": {
              "properties": [
                {
                  "property_value_type": "string",
                  "property_name": "order_no"
                }
              ]
            },
            "all": {
              "properties": [
                {
                  "property_value_type": "string",
                  "property_name": "product_type"
                }
              ]
            }
          },
          "is_experimental_property_filter_editable": 0
        }
      ],
      "permission_type": "public",
      "modify_time": 1724056601,
      "metric_num": null,
      "libra_analysis_type": 0,
      "dimensions": [],
      "new_format": 1,
      "dataset_id": 5,
      "ab_analysis_type": 0
    },
    "message": ""
  }
  ```

- 查询UBA指标组详情

  ```JSON
  {
      "code": 0,
      "data": {
          "id": 2,
          "name": "default",
          "status": 1,
          "description": "应用接入测试指标组（系统自建）",
          "type": "uba",
          "uba_report_type": 1,
          "uba_app_id": 0,
          "owners": [
              {
                  "id": -2,
                  "name": "InnerAPI",
                  "avatar": null,
                  "is_superuser": null
              }
          ],
          "app_ids": [
              10000001
          ],
          "import_app_ids": [],
          "tags": [],
          "merge_types": {
              "total_start_time": 0,
              "support_accumulate": 0,
              "support_total": 0,
              "support_avg": 1
          },
          "metric_scenes": [],
          "sla": "",
          "metrics": [
              {
                  "id": 10425,
                  "name": "组合指标-1-灵活",
                  "description": "组合指标-1-灵活",
                  "status": 1,
                  "dsl": {
                      "version": 3,
                      "content": {
                          "queries": [
                              [
                                  {
                                      "event_id": 89,
                                      "event_indicator": "pv_per_dau",
                                      "event_name": "any_event",
                                      "event_type": "origin",
                                      "filters": [
                                          {
                                              "expression": {
                                                  "conditions": [],
                                                  "logic": "and"
                                              }
                                          }
                                      ],
                                      "nickname": "",
                                      "show_label": "A"
                                  }
                              ],
                              [
                                  {
                                      "event_id": 91,
                                      "event_indicator": "pv_per_dau",
                                      "event_name": "app_launch",
                                      "event_type": "origin",
                                      "filters": [],
                                      "nickname": "",
                                      "show_label": "B"
                                  }
                              ],
                              [
                                  {
                                      "formula": "A/B",
                                      "show_label": "metric_relation",
                                      "show_name": "指标关系"
                                  }
                              ]
                          ],
                          "profile_filters": [],
                          "show_option": null,
                          "option": null
                      }
                  },
                  "composed": true,
                  "data_type": "number_4",
                  "type": "tea",
                  "is_required": 0,
                  "permission_type": "public",
                  "calculate_type": "",
                  "create_time": 1726024310,
                  "modify_time": 1726024483,
                  "support_confidence": false,
                  "is_support_major": false,
                  "experiment_num": 0,
                  "key": "",
                  "file": "",
                  "is_hourly": 0,
                  "support_bayes": 0,
                  "need_weighted": 0,
                  "weighted_metric_id": null,
                  "visible": true,
                  "major_metric_num": 0,
                  "has_running_experiments": false,
                  "is_defense_metric": 0,
                  "defenses": [],
                  "use_pre_sql": 0,
                  "pre_alert": 0,
                  "merge_pre_sql": "",
                  "avg_pre_sql": "",
                  "first_entry_avg_pre_sql": "",
                  "extra_info": "{\"is_experimental_property_filter\":1,\"experimental_property_filter_tpl\":{\"A\":{\"event_id\":89,\"event_name\":\"any_event\",\"properties\":[{\"property_type\":\"common_param\",\"property_value_type\":\"string\",\"property_name\":\"user_agent\"}]},\"B\":{\"event_id\":91,\"event_name\":\"app_launch\",\"properties\":[{\"property_type\":\"user_profile\",\"property_value_type\":\"datetime\",\"property_name\":\"first_event_time\"}]},\"all\":{\"properties\":[{\"property_type\":\"user_profile\",\"property_value_type\":\"string\",\"property_name\":\"gender\"}]}}}",
                  "is_experimental_property_filter": 1,
                  "experimental_property_filter_tpl": {
                      "A": {
                          "event_id": 89,
                          "event_name": "any_event",
                          "properties": [
                              {
                                  "property_type": "common_param",
                                  "property_value_type": "string",
                                  "property_name": "user_agent"
                              }
                          ]
                      },
                      "B": {
                          "event_id": 91,
                          "event_name": "app_launch",
                          "properties": [
                              {
                                  "property_type": "user_profile",
                                  "property_value_type": "datetime",
                                  "property_name": "first_event_time"
                              }
                          ]
                      },
                      "all": {
                          "properties": [
                              {
                                  "property_type": "user_profile",
                                  "property_value_type": "string",
                                  "property_name": "gender"
                              }
                          ]
                      }
                  },
                  "is_experimental_property_filter_editable": 1
              }
          ],
          "permission_type": "public",
          "modify_time": 1724814787,
          "metric_num": null,
          "libra_analysis_type": 0,
          "dimensions": [],
          "new_format": 1,
          "dataset_id": null,
          "ab_analysis_type": 0
      },
      "message": ""
  }
  ```



## 全量修改指标信息

**说明：** 全量修改指标的信息，DSL暂时无法修改，只可以修改名称、描述和数据类型
**请求路径：** `/openapi/v3/apps/<app_id>/metrics/<metric_id>`
**请求方法: PUT**
**请求体**

| 参数名称    | 类型   | 是否必须 | 描述         | 备注                                                         |
| ----------- | ------ | -------- | ------------ | ------------------------------------------------------------ |
| name        | string | 是       | 指标名称     | 最大长度50，不可重复                                         |
| description | string | 否       | 指标描述     | 最大长度1000                                                 |
| data_type   | string | 否       | 指标数据类型 | 枚举值 number_0, number_1, number_2, number_3, number_4, number_5, percent_0, percent_1, percent_2, percent_3, percent_4, percent_5 默认为percent_4，即百分数四位小数 |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | int    | 指标ID                            |



## 修改指标状态

**说明：** 修改指标的状态（上线、下线）。**JAVA SDK暂不支持此接口**
**请求路径：** `/openapi/v3/apps/<app_id>/metrics/<metric_id>`
**请求方法: PATCH**
**请求体**

| 参数名称 | 类型 | 是否必须 | 描述     | 备注          |
| -------- | ---- | -------- | -------- | ------------- |
| status   | int  | 是       | 指标状态 | 0-下线 1-上线 |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | int    | 指标ID                            |



## 获取互斥组列表

**说明：** 分页获取APP下互斥组的列表
**请求路径**： /openapi/v3/apps/<app_id>/layers
**请求方法: GET**
**URL查询参数**

| 参数          | 类型   | 说明                                          |
| ------------- | ------ | --------------------------------------------- |
| keyword       | string | 查询关键字，可以根据name和description模糊查询 |
| endpoint_type | int    | 互斥组的端类型。0-客户端层，1-服务端层        |
| page          | int    | 查询页码。默认为1                             |
| page_size     | int    | 每页数量，默认为99                            |

**返回值**

| 参数名称 | 类型   | 说明                                                         |
| -------- | ------ | ------------------------------------------------------------ |
| code     | int    | 接口返回状态，200为成功                                      |
| message  | string | 接口返回信息，成功时默认为success                            |
| data     | object | { "layers": [], "page": { "current_page": 1, // 当前页 "total_pages": 0, // 总页数 "total_items": 0 // 总条目数 } } |

**互斥组信息说明**

| 参数名称          | 类型   | 说明                           |
| ----------------- | ------ | ------------------------------ |
| id                | int    | 互斥组ID                       |
| name              | string | 互斥组名                       |
| description       | string | 描述                           |
| endpoint_type     | int    | 端类型，0-客户端层，1-服务端层 |
| available_traffic | int    | 剩余流量，1000代表100%         |



## 新建互斥组

**说明：** 创建一个新的互斥组
**请求路径：** `/openapi/v3/apps/<app_id>/layers`
**请求方法: POST**
**请求参数**

| 参数名称      | 类型   | 是否必须 | 说明                           |
| ------------- | ------ | -------- | ------------------------------ |
| name          | string | 是       | 互斥组名，长度限制50           |
| description   | string | 否       | 描述，长度限制1000             |
| endpoint_type | int    | 是       | 端类型，0-客户端层，1-服务端层 |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |
| data     | int    | 互斥组ID                          |



## 获取实验报告-分组结论概览

**说明**：获取实验报告分析结论概览
**请求路径** : /openapi/v3/apps/<app_id>/experiments/<experiment_id>/summary-data
**请求方法: GET**
**返回值**

| code    | int    | 接口返回状态，200为成功                      |
| ------- | ------ | -------------------------------------------- |
| message | string | 接口返回信息，成功时默认为success            |
| data    | object | 报告数据，详情请参见下文的报告数据结构说明。 |

**报告数据结构说明**

| **参数名称**  | **参数类型** | **描述**                                            |
| ------------- | ------------ | --------------------------------------------------- |
| summary_infos | list[object] | 报告概览数据，详情请参见下文的summa_infos结构说明。 |
| report_type   | string       | 报告类型：day:天级                                  |
| start_ts      | int          | 查询开始时间，UNIX时间戳                            |
| end_ts        | int          | 查询结束时间，UNIX时间戳                            |
| user_data     | object       | 各版本进组人数                                      |

**summary_infos结构说明**

| **参数名称**      | **参数类型** | **描述**     |
| ----------------- | ------------ | ------------ |
| major_metric_name | string       | 核心指标名称 |
| summary           | list[object] | 指标概览数据 |

**返回示例**

```JSON
{
    "code": 200,
    "data": {
        "summary_infos": [
            {
                "major_metric_name": "any转化率",
                "summary": [
                    {
                        "vid": 339601,
                        "version_name": "8b4b2cfdbd73941123bce96f9ce541e2",
                        "confidence": 3,
                        "conf_interval": [
                            -0.08904,
                            0.08904
                        ],
                        "p": 1.0
                    }
                ]
            }
        ],
        "user_data": {
            "339600": 799,
            "339601": 799
        },
        "start_ts": 1708822800,
        "end_ts": 1713801599,
        "report_type": "day"
    },
    "message": "success"
}
```



## **获取实验报告-核心指标概览**

**说明**：用于获取实验报告分组结论概览
**请求路径** : /openapi/v3/apps/<app_id>/experiments/<experiment_id>/metric-data
**请求方法: POST**
**请求参数**

| 参数名称    | 类型   | 是否必须 | 描述                               | 备注                                                         |
| ----------- | ------ | -------- | ---------------------------------- | ------------------------------------------------------------ |
| metric_id   | int    | 是       | 指标ID                             | 您可以通过获取指标列表接口获取指标ID。                       |
| report_type | string | 是       | 查询类型                           | 时间粒度：天、小时、分钟。私有化：day/hour/five_minuteSaas：只支持day |
| start_ts    | int    | 是       | 查询开始时间，UNIX时间戳           | 默认实验开始时间，不可以早于实验开始时间                     |
| end_ts      | int    | 是       | 查询结束时间，UNIX时间戳           | 默认当前时间，不可以晚于实验结束时间                         |
| dim         | string | 否       | 查询数据统计维度，默认为实验组维度 | 对于客群实验，支持实验和客群维度交叉查询：abversion_usergroup |

**返回值**

| 参数名称 | 类型   | 说明                                         |
| -------- | ------ | -------------------------------------------- |
| code     | int    | 接口返回状态，200为成功                      |
| message  | string | 接口返回信息，成功时默认为success            |
| data     | object | 报告数据，详情请参见下文的报告数据结构说明。 |

**data（报告数据）结构说明**

| 参数名称           | 参数类型     | 描述                                                         |
| ------------------ | ------------ | ------------------------------------------------------------ |
| versions           | list[object] | 实验版本信息，详情请参见下文的版本信息结构说明。             |
| user_groups        | list[object] | 客群信息，只有客群实验且包含客群维度时才返回。               |
| version_usergroups | list[object] | 客群信息，只有客群实验且dim=abversion_usergroup时才返回。    |
| start_ts           | int          | 查询开始时间，UNIX时间戳                                     |
| end_ts             | int          | 查询结束时间，UNIX时间戳                                     |
| available_start_ts | int          | 可用报告开始时间，UNIX时间戳说明当查询的时间范围超出了真实的报告数据产出的时间范围时，调用接口的返回结果为报告有数据的时间范围内的数据，这里的可用报告开始/结束时间，指的是真实返回的报告数据的时间范围。 |
| available_end_ts   | int          | 可用结束时间，UNIX时间戳                                     |
| confidence_level   | int          | 置信度                                                       |
| metric_id          | int          | 指标ID                                                       |
| distribution       | object       | 统计分布数据                                                 |
| daily_data         | object       | 天级、小时级、5分钟级报告数据                                |
| user_data          | object       | 各版本进组人数                                               |

**版本信息结构说明**

| 参数名称 | 参数类型 | 描述                  |
| -------- | -------- | --------------------- |
| id       | int      | 版本ID                |
| name     | string   | 版本名称              |
| config   | object   | 版本配置信息          |
| type     | int      | 0:对照版本 1:实验版本 |
| weight   | int      | 版本权重，0为均分     |
| disabled | bool     | 是否禁用              |

**返回示例**
成功：

```JSON
{
    "code": 200,
    "data": {
        "available_start_ts": 1708822800,
        "available_end_ts": 1713801599,
        "start_ts": 1708822800,
        "end_ts": 1713801599,
        "versions": [
            {
                "id": "339600",
                "name": "版本1",
                "config": {
                    "0304": "111"
                },
                "type": 0,
                "weight": 0,
                "disabled": false
            },
            {
                "id": "339601",
                "name": "版本2",
                "config": {
                    "0304": "222"
                },
                "type": 1,
                "weight": 0,
                "disabled": false
            }
        ],
        "confidence_level": 80,
        "metric_id": 99196,
        "distribution": {
            "339600": {
                "339601": {
                    "p": 1,
                    "m": 0.3416771,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        -0.08904,
                        0.08904
                    ],
                    "half_interval": 0.0890367,
                    "confidence": 3,
                    "mean": {
                        "339600": 0.3416771,
                        "339601": 0.3416771
                    },
                    "variance": {
                        "339600": 0.00028152,
                        "339601": 0.00028152
                    },
                    "mde": 0.14750037,
                    "sample_size": {
                        "339600": 799,
                        "339601": 799
                    },
                    "details": {
                        "numerator": 273,
                        "denominator": 799
                    }
                }
            },
            "339601": {
                "339600": {
                    "p": 0,
                    "m": 0.3416771,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "339600": 0,
                        "339601": 0
                    },
                    "variance": {
                        "339600": 0,
                        "339601": 0
                    },
                    "details": {
                        "numerator": 273,
                        "denominator": 799
                    }
                }
            }
        },
        "daily_data": {
            "2024-03-04": {
                "339600": {
                    "339601": {
                        "p": 1,
                        "m": 0.3416771,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            -0.08904,
                            0.08904
                        ],
                        "half_interval": 0.0890367,
                        "confidence": 3,
                        "mean": {
                            "339600": 0,
                            "339601": 0
                        },
                        "variance": {
                            "339600": 0,
                            "339601": 0
                        },
                        "mde": 0.14750037,
                        "details": {
                            "numerator": 273,
                            "denominator": 799
                        }
                    }
                },
                "339601": {
                    "339600": {
                        "p": 0,
                        "m": 0.3416771,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "339600": 0,
                            "339601": 0
                        },
                        "variance": {
                            "339600": 0,
                            "339601": 0
                        },
                        "details": {
                            "numerator": 273,
                            "denominator": 799
                        }
                    }
                }
            }
        },
        "boxplot": "The current indicator does not support box plots. Please refer to the explanation below for the specific reason.",
        "user_data": {
            "339600": 799,
            "339601": 799
        }
    },
    "message": "success"
}
```

包含客群维度的返回示例：

```JSON
{
    "code": 200,
    "data": {
        "available_start_ts": 1716775273,
        "available_end_ts": 1716998399,
        "start_ts": 1716775273,
        "end_ts": 1716911999,
        "versions": [
            {
                "id": "217",
                "name": "版本1",
                "config": {
                    "zgtest0524": "a"
                },
                "type": 0,
                "weight": 0,
                "disabled": false
            },
            {
                "id": "218",
                "name": "版本2",
                "config": {
                    "zgtest0524": "b"
                },
                "type": 1,
                "weight": 0,
                "disabled": false
            }
        ],
        "confidence_level": 90,
        "metric_id": 10393,
        "distribution": {
            "217_2": {
                "218_1": {
                    "p": 0,
                    "m": 0,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "217_2": 0,
                        "218_1": 0
                    },
                    "variance": {
                        "217_2": 0,
                        "218_1": 0
                    },
                    "details": {
                        "numerator": 0,
                        "denominator": 0
                    }
                },
                "218_2": {
                    "p": 0,
                    "m": 1.5,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "217_2": 0,
                        "218_2": 0
                    },
                    "variance": {
                        "217_2": 0,
                        "218_2": 0
                    },
                    "details": {
                        "numerator": 258,
                        "denominator": 172
                    }
                },
                "217_1": {
                    "p": 0,
                    "m": 1.5045,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "217_2": 0,
                        "217_1": 0
                    },
                    "variance": {
                        "217_2": 0,
                        "217_1": 0
                    },
                    "details": {
                        "numerator": 3009,
                        "denominator": 2000
                    }
                }
            },
            "218_1": {
                "217_2": {
                    "p": 0,
                    "m": 0,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "218_1": 0,
                        "217_2": 0
                    },
                    "variance": {
                        "218_1": 0,
                        "217_2": 0
                    },
                    "details": {
                        "numerator": 0,
                        "denominator": 0
                    }
                },
                "218_2": {
                    "p": 0,
                    "m": 1.5,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "218_1": 0,
                        "218_2": 0
                    },
                    "variance": {
                        "218_1": 0,
                        "218_2": 0
                    },
                    "details": {
                        "numerator": 258,
                        "denominator": 172
                    }
                },
                "217_1": {
                    "p": 0,
                    "m": 1.5045,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "218_1": 0,
                        "217_1": 0
                    },
                    "variance": {
                        "218_1": 0,
                        "217_1": 0
                    },
                    "details": {
                        "numerator": 3009,
                        "denominator": 2000
                    }
                }
            },
            "218_2": {
                "217_2": {
                    "p": 0,
                    "m": 0,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "218_2": 0,
                        "217_2": 0
                    },
                    "variance": {
                        "218_2": 0,
                        "217_2": 0
                    },
                    "details": {
                        "numerator": 0,
                        "denominator": 0
                    }
                },
                "218_1": {
                    "p": 0,
                    "m": 0,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "218_2": 0,
                        "218_1": 0
                    },
                    "variance": {
                        "218_2": 0,
                        "218_1": 0
                    },
                    "details": {
                        "numerator": 0,
                        "denominator": 0
                    }
                },
                "217_1": {
                    "p": 0,
                    "m": 1.5045,
                    "change": 0,
                    "change_rate": 0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "218_2": 0,
                        "217_1": 0
                    },
                    "variance": {
                        "218_2": 0,
                        "217_1": 0
                    },
                    "details": {
                        "numerator": 3009,
                        "denominator": 2000
                    }
                }
            },
            "217_1": {
                "217_2": {
                    "p": 0,
                    "m": 0,
                    "change": -1.5045,
                    "change_rate": -1.0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "217_1": 0,
                        "217_2": 0
                    },
                    "variance": {
                        "217_1": 0,
                        "217_2": 0
                    },
                    "details": {
                        "numerator": 0,
                        "denominator": 0
                    }
                },
                "218_1": {
                    "p": 0,
                    "m": 0,
                    "change": -1.5045,
                    "change_rate": -1.0,
                    "conf_interval": [
                        0,
                        0
                    ],
                    "half_interval": 0,
                    "confidence": 3,
                    "mean": {
                        "217_1": 0,
                        "218_1": 0
                    },
                    "variance": {
                        "217_1": 0,
                        "218_1": 0
                    },
                    "details": {
                        "numerator": 0,
                        "denominator": 0
                    }
                },
                "218_2": {
                    "p": 0.9,
                    "m": 1.5,
                    "change": -0.0045,
                    "change_rate": -0.00299103,
                    "conf_interval": [
                        -0.04927,
                        0.04329
                    ],
                    "half_interval": 0.04628192,
                    "confidence": 3,
                    "mean": {
                        "217_1": 1.5045,
                        "218_2": 1.5
                    },
                    "variance": {
                        "217_1": 0.00012505,
                        "218_2": 0.00146199
                    },
                    "mde": 0.06856722,
                    "sample_size": {
                        "217_1": 2000,
                        "218_2": 172
                    },
                    "details": {
                        "numerator": 258,
                        "denominator": 172
                    }
                }
            }
        },
        "daily_data": {
            "2024-05-27": {
                "217_1": {
                    "217_2": {
                        "p": 0,
                        "m": 0,
                        "change": -1.009,
                        "change_rate": -1.0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_1": 0,
                            "217_2": 0
                        },
                        "variance": {
                            "217_1": 0,
                            "217_2": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    },
                    "218_1": {
                        "p": 0,
                        "m": 0,
                        "change": -1.009,
                        "change_rate": -1.0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_1": 0,
                            "218_1": 0
                        },
                        "variance": {
                            "217_1": 0,
                            "218_1": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    },
                    "218_2": {
                        "p": 0.001,
                        "m": 1.5,
                        "change": 0.491,
                        "change_rate": 0.48662042,
                        "conf_interval": [
                            0.44702,
                            0.52622
                        ],
                        "half_interval": 0.03959949,
                        "confidence": 1,
                        "mean": {
                            "217_1": 0,
                            "218_2": 0
                        },
                        "variance": {
                            "217_1": 0,
                            "218_2": 0
                        },
                        "mde": 0.07158988,
                        "details": {
                            "numerator": 258,
                            "denominator": 172
                        }
                    }
                },
                "217_2": {
                    "217_1": {
                        "p": 0,
                        "m": 1.009,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_2": 0,
                            "217_1": 0
                        },
                        "variance": {
                            "217_2": 0,
                            "217_1": 0
                        },
                        "details": {
                            "numerator": 1009,
                            "denominator": 1000
                        }
                    },
                    "218_1": {
                        "p": 0,
                        "m": 0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_2": 0,
                            "218_1": 0
                        },
                        "variance": {
                            "217_2": 0,
                            "218_1": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    },
                    "218_2": {
                        "p": 0,
                        "m": 1.5,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_2": 0,
                            "218_2": 0
                        },
                        "variance": {
                            "217_2": 0,
                            "218_2": 0
                        },
                        "details": {
                            "numerator": 258,
                            "denominator": 172
                        }
                    }
                },
                "218_1": {
                    "217_1": {
                        "p": 0,
                        "m": 1.009,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_1": 0,
                            "217_1": 0
                        },
                        "variance": {
                            "218_1": 0,
                            "217_1": 0
                        },
                        "details": {
                            "numerator": 1009,
                            "denominator": 1000
                        }
                    },
                    "217_2": {
                        "p": 0,
                        "m": 0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_1": 0,
                            "217_2": 0
                        },
                        "variance": {
                            "218_1": 0,
                            "217_2": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    },
                    "218_2": {
                        "p": 0,
                        "m": 1.5,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_1": 0,
                            "218_2": 0
                        },
                        "variance": {
                            "218_1": 0,
                            "218_2": 0
                        },
                        "details": {
                            "numerator": 258,
                            "denominator": 172
                        }
                    }
                },
                "218_2": {
                    "217_1": {
                        "p": 0,
                        "m": 1.009,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_2": 0,
                            "217_1": 0
                        },
                        "variance": {
                            "218_2": 0,
                            "217_1": 0
                        },
                        "details": {
                            "numerator": 1009,
                            "denominator": 1000
                        }
                    },
                    "217_2": {
                        "p": 0,
                        "m": 0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_2": 0,
                            "217_2": 0
                        },
                        "variance": {
                            "218_2": 0,
                            "217_2": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    },
                    "218_1": {
                        "p": 0,
                        "m": 0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_2": 0,
                            "218_1": 0
                        },
                        "variance": {
                            "218_2": 0,
                            "218_1": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    }
                }
            },
            "2024-05-28": {
                "217_1": {
                    "217_2": {
                        "p": 0,
                        "m": 0,
                        "change": -1.0,
                        "change_rate": -1.0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_1": 0,
                            "217_2": 0
                        },
                        "variance": {
                            "217_1": 0,
                            "217_2": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    },
                    "218_1": {
                        "p": 0,
                        "m": 0,
                        "change": -1.0,
                        "change_rate": -1.0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_1": 0,
                            "218_1": 0
                        },
                        "variance": {
                            "217_1": 0,
                            "218_1": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    },
                    "218_2": {
                        "p": 0,
                        "m": 0,
                        "change": -1.0,
                        "change_rate": -1.0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_1": 0,
                            "218_2": 0
                        },
                        "variance": {
                            "217_1": 0,
                            "218_2": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    }
                },
                "217_2": {
                    "217_1": {
                        "p": 0,
                        "m": 1.0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_2": 0,
                            "217_1": 0
                        },
                        "variance": {
                            "217_2": 0,
                            "217_1": 0
                        },
                        "details": {
                            "numerator": 2000,
                            "denominator": 2000
                        }
                    },
                    "218_1": {
                        "p": 0,
                        "m": 0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_2": 0,
                            "218_1": 0
                        },
                        "variance": {
                            "217_2": 0,
                            "218_1": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    },
                    "218_2": {
                        "p": 0,
                        "m": 0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "217_2": 0,
                            "218_2": 0
                        },
                        "variance": {
                            "217_2": 0,
                            "218_2": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    }
                },
                "218_1": {
                    "217_1": {
                        "p": 0,
                        "m": 1.0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_1": 0,
                            "217_1": 0
                        },
                        "variance": {
                            "218_1": 0,
                            "217_1": 0
                        },
                        "details": {
                            "numerator": 2000,
                            "denominator": 2000
                        }
                    },
                    "217_2": {
                        "p": 0,
                        "m": 0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_1": 0,
                            "217_2": 0
                        },
                        "variance": {
                            "218_1": 0,
                            "217_2": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    },
                    "218_2": {
                        "p": 0,
                        "m": 0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_1": 0,
                            "218_2": 0
                        },
                        "variance": {
                            "218_1": 0,
                            "218_2": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    }
                },
                "218_2": {
                    "217_1": {
                        "p": 0,
                        "m": 1.0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_2": 0,
                            "217_1": 0
                        },
                        "variance": {
                            "218_2": 0,
                            "217_1": 0
                        },
                        "details": {
                            "numerator": 2000,
                            "denominator": 2000
                        }
                    },
                    "217_2": {
                        "p": 0,
                        "m": 0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_2": 0,
                            "217_2": 0
                        },
                        "variance": {
                            "218_2": 0,
                            "217_2": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    },
                    "218_1": {
                        "p": 0,
                        "m": 0,
                        "change": 0,
                        "change_rate": 0,
                        "conf_interval": [
                            0,
                            0
                        ],
                        "half_interval": 0,
                        "confidence": 3,
                        "mean": {
                            "218_2": 0,
                            "218_1": 0
                        },
                        "variance": {
                            "218_2": 0,
                            "218_1": 0
                        },
                        "details": {
                            "numerator": 0,
                            "denominator": 0
                        }
                    }
                }
            }
        },
        "boxplot": "当前指标不支持箱型图，具体原因见下方解读",
        "user_data": {
            "217_1": 2000,
            "217_2": 0,
            "218_1": 0,
            "218_2": 172
        },
        "sql": {
            "user_data": [
                null
            ],
            "distribution_data": [
                null
            ],
            "daily_data": [
                null
            ],
            "boxplot_data": [
                null
            ]
        },
        "user_groups": [
            {
                "id": "1",
                "name": "测试",
                "type": 0
            },
            {
                "id": "2",
                "name": "测试1",
                "type": 1
            }
        ],
        "version_usergroups": [
            {
                "id": "217_1",
                "name": "版本1_测试"
            },
            {
                "id": "217_2",
                "name": "版本1_测试1"
            },
            {
                "id": "218_1",
                "name": "版本2_测试"
            },
            {
                "id": "218_2",
                "name": "版本2_测试1"
            }
        ]
    },
    "message": "success"
}
```

**失败情况说明：**

| 失败情况                                                     | Response                                                     |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| 超出查询范围：小时级：最近2日。从第1日的00点开始。分钟级：当前日。从当前日的00开始。 | `{    "code": 204,    "data": null,    "message": "起止时间不在实验运行有效时间范围内" } ` |
| 实验第一天运行时，要查询天级数据，因天级数据是T+1的，所以此时会报错 | `{    "code": 301,    "data": null,    "message": "实验报告类型错误" } ` |



## 获取MAB实验获胜率

**说明**：获取MAB智能调优实验的各版本获胜概率
**请求路径：**/openapi/v3/apps/<app_id>/experiments/<experiment_id>/mab-probability
**请求方法：GET**
**返回值**

| **参数名称** | **类型** | **说明**                             |
| ------------ | -------- | ------------------------------------ |
| code         | int      | 接口返回状态，200为成功              |
| message      | string   | 接口返回信息，成功时默认为success    |
| data         | object   | 报表数据，详情见下文的报表数据说明。 |

**报表数据说明**

| **参数名称** | **类型**       | **说明**                                           |
| ------------ | -------------- | -------------------------------------------------- |
| versions     | list of object | 各实验版本基本信息，详情见下文的实验版本基本信息。 |
| probs        | list of object | 各实验版本获胜概率，详情见下文的实验版本获胜概率。 |

**实验版本基本信息**

| **参数名称** | **类型** | **说明**                        |
| ------------ | -------- | ------------------------------- |
| id           | int      | 版本ID                          |
| name         | string   | 版本名称                        |
| type         | int      | 版本类型，0：对照组，1：实验组  |
| is_mab       | int      | 是否为mab实验版本，0：否，1：是 |

**实验版本获胜概率**

| **参数名称**            | **类型** | **说明**              |
| ----------------------- | -------- | --------------------- |
| version_id              | int      | 版本ID                |
| probability_to_beat_all | float    | 获胜概率，取值范围0-1 |

**返回示例**

```JSON
{
    "code": 200,
    "data": {
        "versions": [
            {
                "id": "251",
                "name": "版本1",
                "type": 0,
                "is_mab": 0,
            },
            {
                "id": "252",
                "name": "版本2",
                "type": 1,
                "is_mab": 0,
            },
            {
                "id": "253",
                "name": "版本3",
                "type": 1,
                "is_mab": 0,
            },
                        {
                "id": "254",
                "name": "版本1-mab",
                "type": 0,
                "is_mab": 1,
            },
            {
                "id": "255",
                "name": "版本2-mab",
                "type": 1,
                "is_mab": 1,
            },
            {
                "id": "256",
                "name": "版本3-mab",
                "type": 1,
                "is_mab": 1,
            }
        ],
        "probs": [
            {
                "version_id": "251",
                "probability_to_beat_all": 0.0,
            },
            {
                "version_id": "252",
                "probability_to_beat_all": 0.85939893
            },
            {
                "version_id": "253",
                "probability_to_beat_all": 0.14060107
            }
        ],
    },
    "message": "success"
}
```



## 事件创建/修改



### 批量创建事件

**URL** : /datatester/openapi/v3/apps/<app_id>/create_events
**Method: POST**
**说明：**

1. name为事件在APP下的唯一标识
2. 请求体中的事件，如果APP下已有同名事件，则跳过
3. 请求体中的事件，如果存在name重复，则会去重，且以列表中第一个为准
4. name校验规则：长度1-255，仅允许数字、大小写字母、空格【 】、下划线【_】、中横线【-】和点【.】

**请求体**

```json
{
    "events": [
        {
            "name": "aatest1",
            "show_name": "22222",
            "desc": "22222"
        },
        {
            "name": "aatest2",
            "show_name": "11111",
            "desc": "111111"
        }
    ]
}
```

**返回值**

| code    | int    | 接口返回状态，200为成功           |
| ------- | ------ | --------------------------------- |
| message | string | 接口返回信息，成功时默认为success |
| data    | object | null                              |



### 批量更新事件

**URL** : /datatester/openapi/v3/apps/<app_id>/update_events
**Method: POST**
**说明：**

1. name为事件在APP下的唯一标识
2. 请求体中的事件，如果APP下没有该name的事件，则跳过
3. 请求体中的事件，如果存在name重复，则会去重，且以列表中第一个为准

**请求体**

```json
{
    "events": [
        {
            "name": "aatest1",
            "show_name": "22222",
            "desc": "22222"
        },
        {
            "name": "aatest2",
            "show_name": "11111",
            "desc": "111111"
        }
    ]
}
```

**返回值**

| code    | int    | 接口返回状态，200为成功           |
| ------- | ------ | --------------------------------- |
| message | string | 接口返回信息，成功时默认为success |
| data    | object | null                              |



## 创建事件属性接口

**说明：** 用于创建事件属性，属性类型可以指定为事件属性或者事件公共属性，如果是事件属性则必须关联事件列表，如果是事件公共属性则会关联平台中的全部事件。
**请求路径**：/datatester/openapi/v3/apps/<app_id>/create_event_param
**请求方法：POST**
**请求参数**

| 参数名称   | 类型   | 是否必须 | 说明                                                         |
| ---------- | ------ | -------- | ------------------------------------------------------------ |
| name       | string | 是       | 属性名称,只能包含有数字、字母、中横线【-】、下划线【_】、点【.】，名称唯一，长度1-64 |
| show_name  | string | 否       | 属性的显示名称                                               |
| value_type | string | 是       | 数据类型（string、int、float、datetime、list、version）      |
| desc       | string | 否       | 属性描述                                                     |
| type       | int    | 是       | 属性类型（1：事件属性，必须关联其他的事件，2：事件公共属性） |
| events     | list   | 否       | 事件列表（type=1时必须传），格式：[{"name": x}]              |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |



## 修改事件属性接口

**说明：** 用于修改事件属性，属性名称必须在平台中创建过，可以修改属性的显示名称、属性描述以及属性状态，修改属性状态包括启用和禁用。
**路径：** /datatester/openapi/v3/apps/<app_id>/edit_event_param
**请求方法：POST**
**请求参数**

| 参数名称  | 类型   | 是否必须 | 说明                                |
| --------- | ------ | -------- | ----------------------------------- |
| name      | string | 是       | 属性名称                            |
| show_name | string | 否       | 属性的显示名称                      |
| desc      | string | 否       | 属性描述                            |
| status    | bool   | 否       | 属性状态（true：启用，false：禁用） |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |



## 创建用户属性接口

**说明：** 用于创建用户属性，可以添加属性名称、显示名称、数据类型和属性描述。
**路径：** /datatester/openapi/v3/apps/<app_id>/create_user_profile
**请求方法：POST**
**请求参数**

| 参数名称   | 类型   | 是否必须 | 说明                                                         |
| ---------- | ------ | -------- | ------------------------------------------------------------ |
| name       | string | 是       | 属性名称,只能包含有字母、中横线【-】、下划线【_】、点【.】，注意不能包含有数字，名称唯一，长度1-64 |
| show_name  | string | 否       | 属性的显示名称                                               |
| value_type | string | 是       | 数据类型（string、int、float、datetime、list、version）      |
| desc       | string | 否       | 属性描述                                                     |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |



## 修改用户属性接口

**说明：** 用于修改用户属性，属性名称必须是在平台中创建过的，可以修改属性的显示名称、属性描述以及属性状态，属性状态的修改包括对属性进行启动和禁用。
**路径：** /datatester/openapi/v3/apps/<app_id>/edit_user_profile
**请求方法：POST**
**请求参数**

| 参数名称  | 类型   | 是否必须 | 说明                                |
| --------- | ------ | -------- | ----------------------------------- |
| name      | string | 是       | 属性名称                            |
| show_name | string | 否       | 属性的显示名称                      |
| desc      | string | 否       | 属性描述                            |
| status    | bool   | 否       | 属性状态（true：启用，false：禁用） |

**返回值**

| 参数名称 | 类型   | 说明                              |
| -------- | ------ | --------------------------------- |
| code     | int    | 接口返回状态，200为成功           |
| message  | string | 接口返回信息，成功时默认为success |



## 用户信息查询

**说明：**用于查询用户信息（用户ID、用户名），4.8.0版本开始支持。
**路径:** /datatester/openapi/v3/orgs/{org_id}/users
**请求方法**: GET
**请求参数**

| 参数名称 | 参数类型 | 是否必须 | 描述           | 备注     |
| -------- | -------- | -------- | -------------- | -------- |
| name     | string   | 是       | 要搜索的用户名 | 模糊搜索 |

**返回值**

| **参数名称** | **类型** | **说明**                          |
| ------------ | -------- | --------------------------------- |
| code         | int      | 接口返回状态，200为成功           |
| message      | string   | 接口返回信息，成功时默认为success |
| data         | object   | 接口返回的用户信息                |

**data信息**

| **参数名称** | **类型** | **说明**                                                     |
| ------------ | -------- | ------------------------------------------------------------ |
| user         | object   | 用户信息，包含id和name两个参数，详情见下文**用户信息字段**。 |

**用户信息字段**

| **参数名称** | **类型** | **说明** |
| ------------ | -------- | -------- |
| id           | int      | 用户ID   |
| name         | string   | 用户名称 |



五. 业务错误码说明

返回消息体里的code详细的定义

| 错误码 | 含义                                             |
| ------ | ------------------------------------------------ |
| 200    | 成功                                             |
| 403    | 对请求的资源（app、实验等）无权限                |
| 404    | 请求的资源不存在，如查询了不存在的实验ID或指标ID |
| 410    | 请求的资源已被删除                               |
| 40000  | 缺少必填参数                                     |
| 40001  | 参数值错误                                       |
| 40003  | 对请求的接口无访问权限                           |
| 40010  | 调用过于频繁（超过每秒调用次数限制）             |
| 40011  | 超过每天调用次数限制                             |
| 60001  | DSL格式错误                                      |
| 60002  | 指标有已关联实验，无法删除                       |
| 60010  | 流量不足，无法创建实验                           |
| 60011  | 实验的endpoint_type与所属互斥组不一致            |
| 60012  | 测试中实验无法被结束                             |
| 60013  | 草稿态实验不可被openAPI查询或修改                |

